#cloud-config
package_upgrade: true
packages:
- docker.io
- python-pip
runcmd:
- apt-get install docker.io -y
- apt-get install python-pip -y
- service docker start
- usermod -aG docker eshopadmin
- pip install docker-compose
- git clone https://github.com/peterhack/eShopOnWeb.git /home/eshopadmin/eShopOnWeb
- chown -R eshopadmin:eshopadmin /home/eshopadmin/eShopOnWeb
- docker run --name localdb -e 'ACCEPT_EULA=Y' -e 'SA_PASSWORD=eSh0pdb!' -e 'MSSQL_PID=Express' -p 1433:1433 -d mcr.microsoft.com/mssql/server:2017-latest-ubuntu
- docker network create eshoponweb_default
- docker network connect eshoponweb_default localdb
- wget -q https://packages.microsoft.com/config/ubuntu/18.04/packages-microsoft-prod.deb -O packages-microsoft-prod.deb 
- sudo dpkg -i packages-microsoft-prod.deb
- sudo add-apt-repository universe
- sudo apt-get update
- sudo apt-get install apt-transport-https -y
- sudo apt-get update
- sudo apt-get install dotnet-sdk-3.1 -y
- cd /home/eshopadmin/eShopOnWeb/src/Web/
- dotnet restore
- dotnet tool restore
- dotnet ef database update -c catalogcontext -p /home/eshopadmin/eshopOnWeb/src/Infrastructure/Infrastructure.csproj -s /home/eshopadmin/eShopOnWeb/src/Web/Web.csproj
- dotnet ef database update -c appidentitydbcontext -p /home/eshopadmin/eshopOnWeb/src/Infrastructure/Infrastructure.csproj -s /home/eshopadmin/eshopOnWeb/src/Web/Web.csproj
